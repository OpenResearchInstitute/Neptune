% ofdm_802ii
% ofdm_802ii(e1,a1,dt1)... 
% e1,gain imbalance, a1,phase imbalance, dt1 diff time delay
% try ofdm_802hh(0.05, 0.00, 0.0) for gain imbalance
%     ofdm_802hh(0.00, 0.05, 0.0) for phase imbalance
%     ofdm_802hh(0.00, 0.00, 0.5) for diff delay offset

% signal generator, 25 frequencies of a 128 point dft

% global D_frq D_tm D_clk D_gn D_phs Del_t;
clear all
d_frq =0;
d_tm  =0;
d_clk =0;
d_gn  =0;
d_phs =0;
del_t =0;

fd1=zeros(1,128);

for nn=1:10
dx1=(floor(4*rand(1,52))-1.5)/1.5;
dy1=(floor(4*rand(1,52))-1.5)/1.5;
fd1(nn,64-26:64+25)=dx1+j*dy1;
end
% fd1a=fftshift(fd1);
% d1a=ifft(fd1a);
% 
% x1=real(d1a);
% y1=imag(d1a);
% 
subplot(2,2,3)

plot(fd1(:,64-26:64+25),'or')
grid
axis([-1.5 1.5 -1.5 1.5])
axis('square')
title('constellation')


subplot(2,2,2)
ff1=(-1:1/128:1-1/128);
% f1dat=fftshift(fft(d1a,128));
ff2=(-27:24)/64;

plt2a=plot(ff2,real(fd1(:,64-26:64+25)),'ro','linewidth',1.0,'erasemode','none');

grid
title('Real Spectrum')
axis([-1 1 -1.5 1.5])
xlabel('Normalized Frequency')

subplot(2,2,4)
% ff1=(-1:1/128:1-1/128);
% f1dat=fftshift(fft(d1a,128));
% ff2=(-27:24)/128;


% plt3=plot(ff1,imag(f1dat),'linewidth',1.5,'erasemode','xor');
% hold on
plt3a=plot(ff2,imag(fd1(:,64-26:64+25)),'ro','linewidth',1.0,'erasemode','none');
% hold off
grid
title('Imag Spectrum')
axis([-1 1 -1.5 1.5])
xlabel('Normalized Frequency')

% d_frq =D_frq;
% d_tm  =D_tm;
% d_clk =D_clk;
% d_gn  =D_gn;
% d_phs =D_phs;
% del_t =Del_t;

slider_1=uicontrol('style','slider','units','normalized','pos',[0.190 0.885 0.195 0.025],...
         'min',-1,'max',+1,'value',d_frq,...
         'callback',['d_frq=get(slider_1,''val'');',...
             'set(slider_cur_1,''string'',num2str(d_frq)),',...
             'set(gca,''view'',[-1 1]),',...
             'ofdm_802ii_call(d_frq,d_tm,d_clk,d_gn,d_phs,del_t)']);

slider_min_1=uicontrol('style','text','units','normalized','pos',[0.165 0.885 0.025 0.025],...
    'string', num2str(get(slider_1,'min')));

slider_max_1=uicontrol('style','text','units','normalized','pos',[0.395 0.885 0.020 0.025],...
    'string',num2str(get(slider_1,'max')));

slider_cur_1=uicontrol('style','text','units','normalized','pos',[0.415 0.885 0.050 0.025],...
    'string',num2str(get(slider_1,'value')));

slider_title_1=uicontrol('style','text','units','normalized','pos',[0.215 0.910 0.150 0.025],...
    'string','Carrier Frequency Offset');

h1=uicontrol('style','pushbutton','string','Reset','units','normalized',...
    'position',[0.110 0.885 0.050 0.025],'callback',['set(slider_1,''value'',0),',...
     'set(slider_cur_1,''string'',num2str(0)),','d_frq=get(slider_1,''val'');'...
     'ofdm_802ii_call(0,d_tm,d_clk,d_gn,d_phs,del_t)']);


slider_2=uicontrol('style','slider','units','normalized','pos',[0.190 0.815 0.195 0.025],...
         'min',-1,'max',+1,'value',d_tm,...
         'callback',['d_tm=get(slider_2,''val'');',...
             'set(slider_cur_2,''string'',num2str(d_tm)),',...
             'set(gca,''view'',[-1 1]),',...
             'ofdm_802ii_call(d_frq,d_tm,d_clk,d_gn,d_phs,del_t)']);

slider_min_2=uicontrol('style','text','units','normalized','pos',[0.165 0.815 0.025 0.025],...
    'string', num2str(get(slider_2,'min')));

slider_max_2=uicontrol('style','text','units','normalized','pos',[0.395 0.815 0.020 0.025],...
    'string',num2str(get(slider_2,'max')));

slider_cur_2=uicontrol('style','text','units','normalized','pos',[0.415 0.815 0.050 0.025],...
    'string',num2str(get(slider_2,'value')));

slider_title_2=uicontrol('style','text','units','normalized','pos',[0.215 0.840 0.150 0.025],...
    'string','Frame Time Offset');

h2=uicontrol('style','pushbutton','string','Reset','units','normalized',...
    'position',[0.110 0.815 0.050 0.025],'callback',['set(slider_2,''value'',0),',...
     'd_tm=get(slider_2,''val'');',...
     'set(slider_cur_2,''string'',num2str(0)),',...
     'ofdm_802ii_call(d_frq,0,d_clk,d_gn,d_phs,del_t)']);


slider_3=uicontrol('style','slider','units','normalized','pos',[0.190 0.745 0.195 0.025],...
         'min',-1,'max',+1,'value',d_clk,...
         'callback',['d_clk=get(slider_3,''val'');',...
             'set(slider_cur_3,''string'',num2str(d_clk)),',...
             'set(gca,''view'',[-1 1]),',...
             'ofdm_802ii_call(d_frq,d_tm,d_clk,d_gn,d_phs,del_t)']);

slider_min_3=uicontrol('style','text','units','normalized','pos',[0.165 0.745 0.025 0.025],...
    'string', num2str(get(slider_3,'min')));

slider_max_3=uicontrol('style','text','units','normalized','pos',[0.395 0.745 0.020 0.025],...
    'string',num2str(get(slider_3,'max')));

slider_cur_3=uicontrol('style','text','units','normalized','pos',[0.415 0.745 0.050 0.025],...
    'string',num2str(get(slider_3,'value')));

slider_title_3=uicontrol('style','text','units','normalized','pos',[0.215 0.770 0.150 0.025],...
    'string','Sampling Clock Offset');


h3=uicontrol('style','pushbutton','string','Reset','units','normalized',...
    'position',[0.110 0.745 0.050 0.025],'callback',['set(slider_3,''value'',0.0),',...
     'd_clk=get(slider_3,''val'');'...
     'set(slider_cur_3,''string'',num2str(0)),',...
     'ofdm_802ii_call(d_frq,d_tm,0,d_gn,d_phs,del_t)']);


slider_4=uicontrol('style','slider','units','normalized','pos',[0.190 0.675 0.195 0.025],...
         'min',-0.2,'max',+0.2,'value',d_gn,...
         'callback',['d_gn=get(slider_4,''val'');',...
             'set(slider_cur_4,''string'',num2str(d_gn)),',...
             'set(gca,''view'',[-0.2 0.2]),',...
             'ofdm_802ii_call(d_frq,d_tm,d_clk,d_gn,d_phs,del_t)']);

slider_min_4=uicontrol('style','text','units','normalized','pos',[0.165 0.675 0.025 0.025],...
    'string', num2str(get(slider_4,'min')));

slider_max_4=uicontrol('style','text','units','normalized','pos',[0.395 0.675 0.020 0.025],...
    'string',num2str(get(slider_4,'max')));

slider_cur_4=uicontrol('style','text','units','normalized','pos',[0.415 0.675 0.050 0.025],...
    'string',num2str(get(slider_4,'value')));

slider_title_4=uicontrol('style','text','units','normalized','pos',[0.215 0.700 0.150 0.025],...
    'string','I-Q Gain Imbalance');


h4=uicontrol('style','pushbutton','string','Reset','units','normalized',...
    'position',[0.110 0.675 0.050 0.025],'callback',['set(slider_4,''value'',0),',...
     'd_gn=get(slider_4,''val'');'...
     'set(slider_cur_4,''string'',num2str(0)),',...
     'ofdm_802ii_call(d_frq,d_tm,d_clk,0,d_phs,del_t)']);


slider_5=uicontrol('style','slider','units','normalized','pos',[0.190 0.605 0.195 0.025],...
         'min',-0.2,'max',+0.2,'value',d_phs,...
         'callback',['d_phs=get(slider_5,''val'');',...
             'set(slider_cur_5,''string'',num2str(d_phs)),',...
             'set(gca,''view'',[-0.2 0.2]),',...
             'ofdm_802ii_call(d_frq,d_tm,d_clk,d_gn,d_phs,del_t)']);

slider_min_5=uicontrol('style','text','units','normalized','pos',[0.165 0.605 0.025 0.025],...
    'string', num2str(get(slider_5,'min')));

slider_max_5=uicontrol('style','text','units','normalized','pos',[0.395 0.605 0.020 0.025],...
    'string',num2str(get(slider_5,'max')));

slider_cur_5=uicontrol('style','text','units','normalized','pos',[0.415 0.605 0.050 0.025],...
    'string',num2str(get(slider_5,'value')));

slider_title_5=uicontrol('style','text','units','normalized','pos',[0.215 0.630 0.150 0.025],...
    'string','I-Q Phase Imbalance');


h5=uicontrol('style','pushbutton','string','Reset','units','normalized',...
    'position',[0.110 0.605 0.050 0.025],'callback',['set(slider_5,''value'',0),',...
     'd_phs=get(slider_5,''val'');'...
     'set(slider_cur_5,''string'',num2str(0)),',...
     'ofdm_802ii_call(d_frq,d_tm,d_clk,d_gn,0,del_t)']);


slider_6=uicontrol('style','slider','units','normalized','pos',[0.190 0.535 0.195 0.025],...
         'min',-0.2,'max',+0.2,'value',del_t,...
         'callback',['del_t=get(slider_6,''val'');',...
             'set(slider_cur_6,''string'',num2str(del_t)),',...
             'set(gca,''view'',[-0.2 0.2]),',...
             'ofdm_802ii_call(d_frq,d_tm,d_clk,d_gn,d_phs,del_t)']);

slider_min_6=uicontrol('style','text','units','normalized','pos',[0.165 0.535 0.025 0.025],...
    'string', num2str(get(slider_6,'min')));

slider_max_6=uicontrol('style','text','units','normalized','pos',[0.395 0.535 0.020 0.025],...
    'string',num2str(get(slider_6,'max')));

slider_cur_6=uicontrol('style','text','units','normalized','pos',[0.415 0.535 0.050 0.025],...
    'string',num2str(get(slider_6,'value')));

slider_title_6=uicontrol('style','text','units','normalized','pos',[0.215 0.560 0.150 0.025],...
    'string','I-Q Differential Time');

h6=uicontrol('style','pushbutton','string','Reset','units','normalized',...
    'position',[0.110 0.535 0.050 0.025],'callback',['set(slider_6,''value'',0),',...
     'del_t=get(slider_6,''val'');'...
     'set(slider_cur_6,''string'',num2str(0)),',...
     'ofdm_802ii_call(d_frq,d_tm,d_clk,d_gn,d_phs,0)']);



